<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>刘宇航个人学术主页</title>

  <link rel="stylesheet" href="https://unpkg.com/modern-normalize/modern-normalize.css" />
  
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #fff;
      transition: background-color 0.3s, color 0.3s;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 30px;
      margin: 30px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border: 1px solid #e0e0e0;
    }
    
    .btn {
      display: inline-block;
      padding: 10px 20px;
      background: #0074D9;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      margin: 5px;
      transition: background 0.3s;
    }
    
    .btn:hover {
      background: #0056b3;
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid #0074D9;
      color: #0074D9;
    }
    
    .btn-outline:hover {
      background: #0074D9;
      color: white;
    }
    
    .btn-small {
      padding: 5px 10px;
      font-size: 14px;
      background: white;
      color: #0074D9;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    
    .typing {
      overflow: hidden;
      border-right: 2px solid #0074D9;
      white-space: nowrap;
      animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
    }
    
    @keyframes typing {
      from { width: 0 }
      to { width: 100% }
    }
    
    @keyframes blink-caret {
      from, to { border-color: transparent }
      50% { border-color: #0074D9; }
    }
    
    body.dark-theme {
      background-color: #1a1a1a;
      color: #fff;
    }
    
    body.dark-theme .card {
      background: #2d2d2d;
      border-color: #444;
    }
    
    body.dark-theme .btn-outline {
      color: #fff;
      border-color: #fff;
    }
    
    nav a {
      color: white;
      text-decoration: none;
      margin: 0 12px;
      font-weight: bold;
      transition: color 0.2s;
    }
    
    nav a:hover {
      color: yellow;
    }

    #graph {
      width: 100%;
      height: 500px;
      border: 1px solid #ccc;
      margin: 40px 0;
      background: #f8f9fa;
    }
    
    body.dark-theme #graph {
      background: #2d2d2d;
      border-color: #444;
    }
    
    .profile-img {
      max-width: 250px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    @media (max-width: 768px) {
      .header-row {
        flex-direction: column;
        text-align: center;
      }
      
      .hero {
        flex-direction: column;
      }
      
      .hero-left, .hero-right {
        padding: 10px 0;
        text-align: center;
      }
      
      nav {
        margin: 15px 0;
      }
      
      .profile-img {
        max-width: 200px;
      }
    }
  </style>

  <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
</head>
<body>
  <header class="site-header" style="background:#0074D9; padding: 10px 0;">
    <div class="container header-row" style="display:flex; align-items:center; justify-content:space-between; padding:0 20px;">
      <h1 class="logo" style="color:white;">刘宇航</h1>
      <nav class="nav">
        <a href="#about">关于我</a>
        <a href="#projects">项目与论文</a>
        <a href="#kg">MRI 知识图谱</a>
        <a href="#contact">联系</a>
      </nav>
      <button id="themeToggle" class="btn-small">切换暗色</button>
    </div>
  </header>

  <main class="container">
    <section id="hero" class="hero" style="display:flex; margin:40px 0;">
      <div class="hero-left" style="flex:1; padding-right:20px;">
        <h2 class="typing">你好，我是刘宇航</h2>
        <p>专业：医学影像学</p>
        <div class="hero-buttons">
          <a class="btn" href="#kg">查看知识图谱</a>
          <a class="btn btn-outline" href="#projects">查看项目</a>
        </div>
      </div>
      <div class="hero-right" style="flex:1; text-align:center;">
        <!-- 修复图片路径 -->
        <img id="profilePhoto" class="profile-img" src="assets/photo.png" alt="个人照片" onerror="handleImageError(this, 'profile')" />
      </div>
    </section>

    <section id="about" class="card">
      <h3>关于我</h3>
      <p>本科生。</p>
    </section>

    <section id="projects" class="card">
      <h3>项目与论文</h3>
      <p>...</p>
    </section>

    <section id="kg" class="card">
      <h3>MRI 知识图谱</h3>
      <div id="graph"></div>
    </section>

    <section id="contact" class="card">
      <h3>联系我</h3>
      <p>邮箱：Yuhang63513@163.com</p>
      <p>GitHub：<a href="https://github.com/Yuhang63513" target="_blank">github.com/Yuhang63513</a></p>
    </section>
  </main>

  <script>
    // 图片错误处理函数
    function handleImageError(img, type) {
      console.log('图片加载失败:', img.src);
      if (type === 'profile') {
        // 使用占位图代替个人照片
        img.src = 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=250&h=300&fit=crop&crop=face';
        img.alt = '个人照片（占位图）';
      }
    }

    // 检查图片是否存在
    function checkImageExists(url, callback) {
      const img = new Image();
      img.onload = function() { callback(true); };
      img.onerror = function() { callback(false); };
      img.src = url;
    }

    document.addEventListener("DOMContentLoaded", () => {
      console.log("页面加载完成");
      
      // 检查个人照片是否存在
      checkImageExists('assets/photo.png', function(exists) {
        if (!exists) {
          console.log('个人照片不存在，使用占位图');
          const profilePhoto = document.getElementById('profilePhoto');
          profilePhoto.src = 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=250&h=300&fit=crop&crop=face';
        }
      });

      // 主题切换功能
      const themeToggle = document.getElementById('themeToggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          document.body.classList.toggle('dark-theme');
          themeToggle.textContent = document.body.classList.contains('dark-theme') 
            ? '切换亮色' 
            : '切换暗色';
        });
      }

      // Cytoscape 知识图谱 - 移除图片依赖，使用纯色节点
      try {
        let cy = cytoscape({
          container: document.getElementById('graph'),
          elements: [
            { data: { id: 'MRI', label: 'MRI\n磁共振成像' } },
            { data: { id: 'T1', label: 'T1 加权\n组织解剖结构' } },
            { data: { id: 'T2', label: 'T2 加权\n水含量显示' } },
            { data: { id: 'FLAIR', label: 'FLAIR\n液体衰减反转恢复' } },
            { data: { id: 'Diffusion', label: '扩散加权\n水分子扩散' } },

            { data: { id: 'MRI2T1', source: 'MRI', target: 'T1' } },
            { data: { id: 'MRI2T2', source: 'MRI', target: 'T2' } },
            { data: { id: 'MRI2FLAIR', source: 'MRI', target: 'FLAIR' } },
            { data: { id: 'MRI2Diffusion', source: 'MRI', target: 'Diffusion' } }
          ],
          style: [
            {
              selector: 'node',
              style: {
                'shape': 'round-rectangle',
                'width': 140,
                'height': 100,
                'label': 'data(label)',
                'text-valign': 'center',
                'text-halign': 'center',
                'color': '#333',
                'background-color': '#e3f2fd',
                'border-width': 3,
                'border-color': '#0074D9',
                'font-size': '14px',
                'font-weight': 'bold',
                'text-wrap': 'wrap',
                'text-max-width': '120px'
              }
            },
            {
              selector: 'node:selected',
              style: {
                'background-color': '#bbdefb',
                'border-color': '#0056b3'
              }
            },
            {
              selector: 'edge',
              style: {
                'width': 3,
                'line-color': '#0074D9',
                'target-arrow-color': '#0074D9',
                'target-arrow-shape': 'triangle',
                'curve-style': 'bezier'
              }
            }
          ],
          layout: { 
            name: 'cose', 
            padding: 50,
            animate: true,
            animationDuration: 1000,
            idealEdgeLength: 100,
            nodeRepulsion: 4500
          }
        });

        // 点击节点高亮
        cy.on('tap', 'node', function(evt) {
          let node = evt.target;
          cy.elements().removeClass('highlighted');
          node.addClass('highlighted');
          node.neighborhood().addClass('highlighted');
        });

        // 点击空白区域重置
        cy.on('tap', function(evt) {
          if (evt.target === cy) {
            cy.elements().removeClass('highlighted');
          }
        });

        // 添加高亮样式
        cy.style()
          .selector('.highlighted')
          .style({
            'opacity': 1
          })
          .selector('node:not(.highlighted)')
          .style({
            'opacity': 0.3
          })
          .selector('edge:not(.highlighted)')
          .style({
            'opacity': 0.2
          })
          .update();

      } catch (error) {
        console.error('知识图谱初始化失败:', error);
        document.getElementById('graph').innerHTML = `
          <div style="text-align:center; padding:50px;">
            <h4>知识图谱加载失败</h4>
            <p>请刷新页面重试</p>
            <button onclick="window.location.reload()" class="btn" style="margin-top:20px;">刷新页面</button>
          </div>
        `;
      }
    });
  </script>
</body>
</html>